(function(a){var c="postalcode",b="textlineinput";a.validator.addMethod(b,function(b,d,c){if(!b)return true;try{var a=b.match(c);return a&&a.index===0&&a[0].length===b.length}catch(e){return false}});a.validator.unobtrusive.adapters.add(b,["pattern"],function(a){a.rules.textlineinput=a.params.pattern;if(a.message)a.messages.textlineinput=a.message});a.validator.unobtrusive.adapters.addSingleVal(b,"pattern");a.validator.addMethod(c,function(i,j,c){if(!i)return true;try{var g=a("#Country").val(),d=a("#PostalCode").val(),h=d.match(c.unitedStatesPattern),f=d.match(c.internationalPattern),e="",b;if(g.toLowerCase()==="united states"){e=c.unitedStatesErrorMessage;b=h}else{e=c.internationalErrorMessage;b=f}a.extend(a.validator.messages,{postalcode:e});return b&&b.index===0&&b[0].length===d.length}catch(k){return false}});a.validator.unobtrusive.adapters.add(c,["internationalErrorMessage","unitedStatesErrorMessage","internationalPattern","unitedStatesPattern"],function(a){a.rules.postalcode=a.params})})(jQuery);(function(a){var c="/Dashboard";a.log=function(b){var a="undefined";typeof console!==a&&typeof console.log!==a&&console.log(b)};a.strings={shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]};a.makeDate=function(g){var c=g.replace(/^\/Date\(/,"").replace(/\)\//,""),b=new Date(Number(c)),f=b.getDate().toString(),d=a.strings.shortMonths[b.getMonth()],e=b.getFullYear().toString();return f+" "+d+" "+e};a.makeMoney=function(a){a=(Math.round(a*100)/100).toString();if(a.indexOf(".")>=0){if(a.substring(a.indexOf(".")+1).length===1)a+="0"}else a+=".00";return a};a.makeMPGDisplay=function(a){return Math.round(a).toString()};a.makeCostToDriveDisplay=function(c){var b=a.makeMoney(c*100);return Math.round(b).toString()};a.makeCostPerMonthDisplay=function(c){var b=a.makeMoney(c);return Math.round(b).toString()};a.getRelativeEndpointUrl=function(d){var c,e=function(a){return a===null||a===undefined?"":a.split("/")},f=function(b,a){for(c=0;c<a.length;c+=1)if(a[c].length>0)b+="/"+a[c];return b},g=e(a.rootUrl),h=e(d),b="";if(!d)return"";if(d.indexOf(a.rootUrl||"")===0)return d;b=f(b,g);b=f(b,h);return b};a.getBaseUrl=function(){return a.getRelativeEndpointUrl(c)};function b(c,e){var b=e[c],d;if(!b){a.log("Attempted to create a helper for "+c+" but the widget was not found in the options.");return}d=b[c];return function(){return d.apply(b,arguments)}}a.setupWidgetInvocationMethods=function(f,e,d){for(var a,c=d.length-1;c>=0;c-=1){a=d[c];f["_"+a]=b(a,e)}}})(this.mstats=this.mstats||{},jQuery);(function(a){a.events={status:"status",vehicle:{details:{selected:"details/selected"},fillups:{selected:"fillups/selected"},reminders:{selected:"reminders/selected",fulfilled:"reminders/fulfilled"},add:{selected:"add/selected"},deleted:"delete/succeeded"},dashboard:{selected:"dashboard/selected"},charts:{selected:"charts/selected"}}})(this.mstats=this.mstats||{},jQuery);(function(a){a.pubsub=function(){var b=[],c={};c.publish=function(c,g){var f,e,d=0;if(b[c])e=setInterval(function(){if(b[c][d]){try{f=b[c][d].context||this;b[c][d].callback.call(f,g)}catch(h){a.log('An error occurred in one of the callbacks for the event "'+c+'"');a.log('The error was: "'+h+'"')}d+=1}else clearInterval(e)},0)};c.subscribe=function(a,c,d){if(!b[a])b[a]=[];b[a].push({callback:c,context:d})};c.unsubscribe=function(a,c,d){b[a]&&b[a].pop({callback:c,context:d})};return c}()})(this.mstats=this.mstats||{},jQuery);(function(a,b){a.dataStore={_data:{},"get":function(a){return this._data[a]},"set":function(b,a){this._data[b]=a},clear:function(a){this._data[a]=undefined},clearAll:function(){this._data={}}};a.dataManager={dataDefaults:{dataType:"json",type:"POST"},sendRequest:function(d){var g=a.dataManager,e=a.getRelativeEndpointUrl(d.url),f=a.dataStore.get(e),c=b.extend({cache:true},g.dataDefaults,d,{url:e});if(c.cache&&f){d.success(f);return}c.success=function(b){c.cache&&a.dataStore.set(e,b);d.success(b)};b.ajax(c)},resetData:function(b){a.dataStore.clear(a.getRelativeEndpointUrl(b))}}})(this.mstats=this.mstats||{},jQuery);(function(a,b){var c={saveError:1,saved:2,saving:3,loadError:4};b.widget("mstats.status",{options:{duration:3e3,subscribe:function(){a.log("The subscribe option on status has not been set")}},_create:function(){this.options.subscribe(a.events.status,this._statusSubscription,this)},currentStatus:null,_statusSubscription:function(a){var c=this,d=c,b=c.currentStatus;a.priority=c._getPriority(a);b&&a.priority<b.priority&&clearTimeout(b.timer);b=a;c.element.text(a.message).show();b.timer=setTimeout(function(){d.element.fadeOut();d.currentStatus=null},a.duration||c.options.duration)},_getPriority:function(a){return c[a.type]},destroy:function(){this.currentStatus&&clearTimeout(this.currentStatus.timer);b.Widget.prototype.destroy.call(this)}})})(this.mstats=this.mstats||{},jQuery);(function(b,a){a.widget("mstats.header",{options:{title:"",displayName:""},_create:function(){this._adjustNavigation()},_adjustNavigation:function(){var c=a.bbq.getState()||{},e=this.element.data("url"),d=b.getRelativeEndpointUrl(e);c.layout="dashboard";this.element.find("#dashboard-link").attr("href",a.param.fragment(d,c));c.layout="charts";this.element.find("#charts-link").attr("href",a.param.fragment(d,c))},_setOption:function(c,b){switch(c){case"title":this.element.find("[data-title]").text(b);break;case"displayName":this.element.find("[data-display-name]").text(b)}a.Widget.prototype._setOption.apply(this,arguments)}})})(this.mstats,jQuery);(function(a){a.widget("mstats.tile",{moveTo:function(b,d){var e=this,c=0;this._unlock();if(b.length){c=b.length;a.each(b,function(b,a){if(b===c-1)e._animate(a,d);else e._animate(a)})}else this._animate(b,d)},_animate:function(a,b){this.element.animate(a.position,{duration:a.duration,complete:function(){b&&b()}})},_unlock:function(){this.element.css({position:"absolute","float":"none"})},beginAnimation:function(){var a=this.element;a.css({top:a.position().top+"px",left:a.position().left+"px"})},endAnimation:function(){this.element.attr("style","").css({top:0,left:0,position:"relative","float":"left"})}})})(jQuery);(function(m,j){var k="collapsed",d="compact",i=":mstats-vehicle",h=".statistics",g=".cost-per-month",f=".cost-per-mile",b=".unit",a=".quantity",e=".mile-per-gallon",c=600,l=800;j.widget("mstats.vehicle",{options:{id:0,collapsed:false},_create:function(){var a=this;a._setOption("id",a.element.data("vehicle-id"));a._adjustNavigation();a.options.collapsed&&a._forceCollapse()},_forceCollapse:function(){this.element.find(e).find(a).hide().end().find(b).hide().end().end().find(f).find(a).hide().end().find(b).hide().end().end().find(g).find(a).hide().end().find(b).hide().end().end().find(h).height(0).closest(i).addClass(d)},_adjustNavigation:function(){var a=this;this.element.find("[data-action]").each(function(){var c=j(this),f=c.data("action"),e=a.options.id,b=j.bbq.getState()||{},d=m.getBaseUrl();b.vid=e;switch(f){case"vehicle-details-selected":b.layout="details";break;case"vehicle-fillups-selected":b.layout="fillups";break;case"vehicle-reminders-selected":b.layout="reminders";break;case"vehicle-add-selected":b.layout="addVehicle";b.vid=undefined}c.attr("href",j.param.fragment(d,b))})},collapse:function(){if(this.options.collapsed)return;this.element.find(e).find(a).fadeOut(c).end().find(b).fadeOut(c).end().end().find(f).find(a).fadeOut(c).end().find(b).fadeOut(c).end().end().find(g).find(a).fadeOut(c).end().find(b).fadeOut(c).end().end().find(h).animate({height:0},{duration:l,easing:"linear",complete:function(){j(this).closest(i).addClass(d)}});this._setOption(k,true)},expand:function(){if(!this.options.collapsed)return;this.element.removeClass(d).find(h).animate({height:115},{duration:l,easing:"linear"}).find(e).find(a).fadeIn(c).end().find(b).fadeIn(c).end().end().find(f).find(a).fadeIn(c).end().find(b).fadeIn(c).end().end().find(g).find(a).fadeIn(c).end().find(b).fadeIn(c).end().end();this._setOption(k,false)}})})(this.mstats,jQuery);(function(p,c){var h="endAnimation",o="beginAnimation",d="id",b="option",i="compact",g=":mstats-vehicle",a=":mstats-tile",n="vehicle-id",e=".vehicle",m="selectedVehicleId",f=false,l=true,k="dashboard",j=600,q=400,r;c.widget("mstats.vehicleList",{options:{sendRequest:function(a){c.ajax(a)},invalidateData:function(){p.log("no data invalidation function provided.")},layout:k,publish:function(){p.log("The publish option on vehicleList has not been set")},selectedVehicleId:0,visible:l,isCollapsed:f},_create:function(){var a=this;r=a.element.data("list-url");a._widgetizeVehicleTiles();a._bindEventHandlers();a._makeSortable();a._getVehicleData();a._setOptions(a.options);if(a.options.layout!==k){a._setOption("isCollapsed",l);a._checkSelectedVehicleId()}},_bindEventHandlers:function(){var a=this;this.element.delegate("[data-action]","click."+this.name,function(){a._setOption(m,c(this).closest(e).data(n))})},_widgetizeVehicleTiles:function(){this.element.find("#vehicle-list-content > div").tile().find(e).vehicle()},_getVehicleData:function(){var b=this,a=b,d=c(b.options.templateId);if(!d.length){b._showVehicles();p.log("Cannot apply templates as there is no template defined.");return}b.options.sendRequest({url:r,success:function(f){var b=d.tmpl(f),e=c("#mstats-add-vehicle-button-template").tmpl();a.element.find("#vehicle-list-content").html(b).append(e);a._widgetizeVehicleTiles();a._setOptions(a.options);a._showVehicles()},error:function(){a._hideVehicles();a._showErrorMessage()}})},_hideVehicles:function(){this.element.find(a).hide()},_showVehicles:function(){this.element.find(a).show()},_publishStatus:function(a){this.options.publish(p.events.status,a)},_showErrorMessage:function(){this._publishStatus({type:"loadError",message:"An error occurred while loading the requested data. Please try again.",duration:1e4})},_showSaveMessage:function(){this._publishStatus({type:"saving",message:"Saving sort order ..."})},_showSavedMessage:function(){this._publishStatus({type:"saved",message:"Sort order saved",duration:5e3})},_showSaveErrorMessage:function(){this._publishStatus({type:"saveError",message:"An error occurred while saving the sort order. Please reload the page and try again.",duration:1e4})},_makeSortable:function(){var a=this;this.element.sortable({axis:f,items:":mstats-tile:has(:mstats-vehicle)",containment:"#vehicles",handle:".header",stop:function(){a.saveSortOrder()}})},saveSortOrder:function(){var a=this,d=a,e=a.element.data("sort-url"),b=[];a.element.find(g).each(function(){var a=c(this).data(n);b.push(a)});a._showSaveMessage();a.options.sendRequest({url:e,cache:f,data:{SortOrder:b.toString()},success:function(){d._showSavedMessage()},error:function(){d._showSaveErrorMessage()}})},_setOption:function(d,b){var a=this;c.Widget.prototype._setOption.apply(a,arguments);if(b<=0)return;switch(d){case"layout":a._setLayoutOption(b);break;case m:a._expandVehicle(b);a._collapseVehicles()}},_checkSelectedVehicleId:function(){var b,a=c.bbq.getState()||{};if(a.vid){b=parseInt(a.vid,10);b!==this.options.selectedVehicleId&&this._setOption(m,a.vid)}},_setLayoutOption:function(a){switch(a.toLowerCase()){case k:this.element.removeAttr("style").removeClass(i).sortable(b,"axis",f);break;case"details":case"reminder":case"fillup":this.element.removeAttr("style").addClass(i).sortable(b,"axis","y");this._collapseVehicles()}},_collapseVehicles:function(){var a=this.options.selectedVehicleId;this.element.find(g).each(function(){var e=c(this);e.vehicle(b,d)!==a&&e.vehicle("collapse")})},_expandVehicles:function(){this.element.find(g).each(function(){c(this).vehicle("expand")})},_expandVehicle:function(e){var a=e;this.element.find(g).each(function(){var e=c(this);e.vehicle(b,d)===a&&e.vehicle(b,"collapsed")&&e.vehicle("expand")})},_narrowToSingleColumn:function(){var a=this.element;!this.options.isCollapsed&&a.delay(q).animate({left:0},{duration:j,complete:function(){a.addClass(i)}})},_expandToDoubleColumn:function(){this.options.isCollapsed&&this.element.removeClass(i).animate({left:400},{duration:j})},_scrollToSelectedVehicle:function(){var f=this;this.element.find(a).each(function(){var h,a,g=c(this);h=g.find(e).vehicle(b,d);a=g.offset().top;if(h===f.options.selectedVehicleId)a>300&&c("html, body").delay(q).animate({scrollTop:a},500)})},goToDetailsLayout:function(){var f=this,m,n=0,p=f,g=0,k,i=c.bbq.getState()||{};f._checkSelectedVehicleId();m=f.options.selectedVehicleId;if(!f.options.isCollapsed){f.element.find(a).each(function(){c(this).tile(o)});f.element.find(a).each(function(){var f=c(this);n=f.find(e).vehicle(b,d);k=[{position:{top:g},duration:j},{position:{left:0},duration:j}];f.tile("moveTo",k,function(){p.element.find(a).each(function(){c(this).tile(h)})});if(n===m)g+=321;else g+=206});f._narrowToSingleColumn()}f._scrollToSelectedVehicle();if(i&&i.layout)f.options.layout=i.layout;f.options.isCollapsed=l},goToDashboardLayout:function(){var g=this,m=0,l=g,i;g.options.layout=k;g.options.selectedVehicleId=0;if(!g.options.isCollapsed)return;g.element.find(a).each(function(){c(this).tile(o)});g._expandToDoubleColumn();g.element.find(a).each(function(g){var f=c(this);m=f.find(e).vehicle(b,d);i=[{position:{left:g%2*260},duration:j},{position:{top:Math.floor(g/2)*320},duration:j}];l._expandVehicles();f.tile("moveTo",i,function(){l.element.find(a).each(function(){c(this).tile(h)})})});g.options.isCollapsed=f},moveOffScreen:function(){var a=this,b=a;if(!a.options.visible)return;a.element.css("position","absolute").delay(q).animate({left:"-=600",opacity:0},{duration:j,complete:function(){b.element.hide()}});a.options.visible=f},moveOnScreen:function(){if(this.options.visible)return;this.element.css("opacity",0).animate({opacity:1,left:"+=600"},j).show();this._setOption("visible",l)},_invalidateData:function(){c.isFunction(this.options.invalidateData)&&this.options.invalidateData(r)},refreshData:function(){this._getVehicleData()},requeryData:function(){this._invalidateData();this.refreshData()},destroy:function(){var b="destroy";this.element.sortable(b).find(a).tile(b).find(g).vehicle(b);c.Widget.prototype.destroy.call(this)}})})(this.mstats=this.mstats||{},jQuery);(function(b,a){var c=".content";a.widget("mstats.vehicleDetails",{options:{sendRequest:function(b){a.ajax(b)},publish:function(){b.log("The publish option on vehicleDetails has not been set")},invalidateData:function(){b.log("The invalidateData option on vehicleDetails has not been set")},templateId:""},selectedVehicleName:"",_create:function(){var a=this;b.setupWidgetInvocationMethods(a,a.options,["header"]);a._bindNavigation();a._setOptions(a.options)},_bindNavigation:function(){var b=this;this.element.delegate("[data-action]","click.vehicleDetails",function(e){var c=a(this),d=c.data("action");switch(d){case"vehicle-delete-selected":b.deleteVehicle(c.data("action-url"));e.preventDefault()}})},_getVehicleData:function(){var d=this,c=d;d.selectedVehicleName=undefined;d._hideVehicleDetails();d.options.sendRequest({url:d._createRequestUrl(),success:function(e){var d;if(!a(c.options.templateId).length){c._showVehicleDetails();b.log("Vehicle Details: Cannot apply templates as there is no template defined.");return}c.element.html(a(c.options.templateId).tmpl(e,{createRemindersLink:function(e){var c=a.bbq.getState()||{},d=b.getBaseUrl();c.layout="reminders";c.vid=e;return a.param.fragment(d,c)}}));c._attachCharts();c.selectedVehicleName=e.Name;d=c._header("option","title")||"";d.indexOf(" for ")===-1&&c._header("option","title",d+" for "+e.Name);c._showVehicleDetails()},error:function(){c._hideVehicleDetails();c._showErrorMessage()}})},_attachCharts:function(){this.element.find("#vehicle-charts").vehicleCharts({sendRequest:this.options.sendRequest,invalidateData:this.options.invalidateData})},_deleteVehicle:function(c){var a=this;this.options.sendRequest({url:c,cache:false,success:function(){a._showDeletedMessage();a.options.publish(b.events.vehicle.deleted,{})},error:function(){a._showDeleteErrorMessage()}})},_showVehicleDetails:function(){this.element.find(c).show()},_hideVehicleDetails:function(){this.element.find(c).hide()},_publishStatus:function(a){this.options.publish(b.events.status,a)},_showErrorMessage:function(){this._publishStatus({type:"loadError",message:"An error occurred while loading the requested data.  Please try again.",duration:1e4})},_showDeletingMessage:function(){this._publishStatus({type:"saving",message:"Deleting the selected vehicle ...",duration:5e3})},_showDeletedMessage:function(){this._publishStatus({type:"saved",message:"Vehicle deleted.",duration:5e3})},_showDeleteErrorMessage:function(){this._publishStatus({type:"saveError",message:"An error occurred while deleting the selected vehicle.  Please try again.",duration:1e4})},_createRequestUrl:function(){return this.options.dataUrl+"/"+this.options.selectedVehicleId},_setOption:function(c,b){a.Widget.prototype._setOption.apply(this,arguments);if(b<=0)return;switch(c){case"selectedVehicleId":this.refreshData()}},refreshData:function(){this._getVehicleData()},requeryData:function(){this.options.invalidateData(this._createRequestUrl());this.refreshData()},getSelectedVehicleName:function(){return this.selectedVehicleName||""},deleteVehicle:function(b){var a=confirm("Really delete the selected vehicle?");a&&this._deleteVehicle(b)}})})(this.mstats,jQuery);(function(d,a){var c=".content",b="selectedFillupId";a.widget("mstats.fillups",{options:{sendRequest:function(b){a.ajax(b)},publish:function(){d.log("The publish option on fillups has not been set")},invalidateData:function(){d.log("no data invalidation function provided.")},selectedVehicleId:0,selectedFillupId:0,templateId:""},data:null,_create:function(){this._bindNavigation();this._setOptions(this.options)},_bindNavigation:function(){var c=this;this.element.delegate("[data-action]","click."+this.name,function(d){if(a(this).data("action")==="select-fillup"){c._setOption(b,a(this).data("fillup-id"));d.preventDefault()}})},_getFillupData:function(){var c=this,b=c;c._hideFillups();c.options.sendRequest({url:c.options.dataUrl+"/"+c.options.selectedVehicleId,success:function(c){if(!a(b.options.templateId).length){b._showFillups();d.log("Fillups: Cannot apply templates as there is no template defined.");return}b.data=c;b._updateSelectedFillup();b._applyTemplate();b._showFillups()},error:function(){b._hideFillups();b._showErrorMessage()}})},_applyTemplate:function(){var b=this,d=b.options,c=a(d.templateId);c.length&&b.data&&b.element.html(c.tmpl(b.data))},_showFillups:function(){this.element.find(c).show()},_hideFillups:function(){this.element.find(c).hide()},_updateSelectedFillup:function(){var c,d,b=this.data,a=b.Fillups,e=this.options.selectedFillupId;if(a&&a.length)if(e>0){b.SelectedFillup=a[0];for(c=0;c<a.length;c+=1){d=a[c];if(d.FillupEntryId===e){b.SelectedFillup=d;break}}}else b.SelectedFillup=a[0]},_publishStatus:function(a){this.options.publish(d.events.status,a)},_showErrorMessage:function(){this._publishStatus({type:"loadError",message:"An error occurred while loading the requested data.  Please try again.",duration:1e4})},_setOption:function(e,d){var c=this;a.Widget.prototype._setOption.apply(c,arguments);if(d<=0)return;switch(e){case"selectedVehicleId":c.refreshData();break;case b:c._updateSelectedFillup();c._applyTemplate()}},refreshData:function(){this._getFillupData()},requeryData:function(){this.options.invalidateData(this.options.dataUrl);this.refreshData()}})})(this.mstats,jQuery);(function(c,b){var d=".content",a="selectedReminderId";b.widget("mstats.reminders",{options:{sendRequest:function(a){b.ajax(a)},publish:function(){c.log("The publish option for reminders has not been set")},invalidateData:function(){c.log("The invalidateData option for reminders has not been set")},selectedVehicleId:0,selectedReminderId:0,templateId:""},data:{},_create:function(){this._bindNavigation();this._setOptions(this.options)},_bindNavigation:function(){var c=this;this.element.delegate("[data-action]","click."+this.name,function(e){var d=b(this),g=d.data("action"),f=d.data("reminder-id");switch(g){case"select-reminder":c._setOption(a,f);e.preventDefault();break;case"reminder-fulfill-selected":c.fulfillReminder(d.data("action-url"));e.preventDefault()}})},_fulfillReminder:function(b){var a=this;this._showFulfillingMessage();this.options.sendRequest({url:b,dataType:"json",cache:false,success:function(){a._showFulfilledMessage();a.options.publish(c.events.vehicle.reminders.fulfilled,{})},error:function(){a._showFulfillErrorMessage()}})},_getReminderData:function(){var a=this;this._hideReminders();this.options.sendRequest({url:a._createRequestUrl(),success:function(d){if(!b(a.options.templateId).length){a._showReminders();c.log("reminders: Cannot apply templates as there is no template defined.");return}a.data=d;a._updateSelectedReminder();a._applyTemplate();a._showReminders()},error:function(){a._hideReminders();a._showErrorMessage()}})},_updateSelectedReminder:function(){var e=this.options.selectedReminderId,b=this.data,d,c;if(b.Reminders&&b.Reminders.length)if(e>0)for(c=0;c<b.Reminders.length;c+=1){d=b.Reminders[c];if(d.ReminderId===e){b.SelectedReminder=d;break}}else{b.SelectedReminder=b.Reminders[0];this._setOption(a,b.SelectedReminder.ReminderId)}},_applyTemplate:function(){var a=this,d=a.options,c=b(d.templateId);c.length&&a.data&&a.element.html(c.tmpl(a.data))},_showReminders:function(){this.element.find(d).show()},_hideReminders:function(){this.element.find(d).hide()},_publishStatus:function(a){this.options.publish(c.events.status,a)},_showErrorMessage:function(){this._publishStatus({type:"loadError",message:"An error occurred while loading the requested data.  Please try again.",duration:1e4})},_showFulfillingMessage:function(){this._publishStatus({type:"saving",message:"Fulfilling the selected reminder ...",duration:5e3})},_showFulfilledMessage:function(){this._publishStatus({type:"saved",message:"Reminder Fulfilled.",duration:5e3})},_showFulfillErrorMessage:function(){this._publishStatus({type:"saveError",message:"An error occurred while fulfilling the selected reminder.  Please try again.",duration:1e4})},_setOption:function(e,d){var c=this;b.Widget.prototype._setOption.apply(c,arguments);if(d<=0)return;switch(e){case"selectedVehicleId":c.refreshData();break;case a:c._updateSelectedReminder();c._applyTemplate()}},_createRequestUrl:function(){return this.options.dataUrl+"/"+this.options.selectedVehicleId},fulfillReminder:function(a){var b=confirm("Are you sure you want to fulfill this reminder?");b&&this._fulfillReminder(a)},refreshData:function(){this._setOption(a,-1);this._setOption("data",{});this._getReminderData()},requeryData:function(){this.options.invalidateData(this._createRequestUrl());this.refreshData()}})})(this.mstats,jQuery);(function(j,h){var g="requeryData",i="relative",a=true,f="title",b="option",d="selectedVehicleId",e="div:first",k=null,c=false,l=600,m=550;h.widget("mstats.infoPane",{options:{visible:c,activePane:"details",selectedVehicleId:0,sendRequest:function(){j.log("The sendRequest option on infoPane has not been set")},invalidateData:function(){j.log("The invalidateData option on infoPane has not been set")},publish:function(){j.log("The publish option on infoPane has not been set")},header:k},fillups:k,reminders:k,vehicleDetails:k,_create:function(){var a=this;a._setupDetailsPane();a._setupRemindersPane();a._setupFillupsPane();j.setupWidgetInvocationMethods(a,a,["fillups","reminders","vehicleDetails"]);j.setupWidgetInvocationMethods(a,a.options,["header"]);a._bindNavigation()},_setupDetailsPane:function(){var a="#details-pane",c=this.element,b=this.options;!c.find(a).length&&c.find(e).append('<div id="details-pane" class="tab opened section" />');this.vehicleDetails=c.find(a).vehicleDetails({sendRequest:b.sendRequest,dataUrl:c.data("details-url"),templateId:"#mstats-vehicle-details-template",invalidateData:b.invalidateData,publish:b.publish,header:b.header})},_setupFillupsPane:function(){var a="#fillups-pane",b=this.element,c=this.options;!b.find(a).length&&b.find(e).append('<div id="fillups-pane" class="tab section" />');this.fillups=b.find(a).fillups({sendRequest:c.sendRequest,dataUrl:b.data("fillups-url"),templateId:"#mstats-fillups-template",invalidateData:c.invalidateData,publish:c.publish})},_setupRemindersPane:function(){var a="#reminders-pane",b=this.element,c=this.options;!b.find(a).length&&b.find(e).append('<div id="reminders-pane" class="tab section" />');this.reminders=b.find(a).reminders({sendRequest:c.sendRequest,dataUrl:b.data("reminders-url"),templateId:"#mstats-reminders-template",invalidateData:c.invalidateData,publish:c.publish})},_bindNavigation:function(){var a=this;this.element.delegate("[data-info-nav]","click.infoPane",function(c){var b=h(this).data("info-nav");a._setHashLayout(b);c.preventDefault()})},_setOption:function(e,b){var a=this;h.Widget.prototype._setOption.apply(a,arguments);switch(e){case d:b=parseInt(b,10);a._setSelectedVehicleId(b);break;case"activePane":var c="_"+b+"Selected";a[c]&&a[c]()}},getSelectedVehicleName:function(){return this._vehicleDetails("getSelectedVehicleName")},_setSelectedVehicleId:function(a){this._vehicleDetails(b,d,a);this._fillups(b,d,a);this._reminders(b,d,a)},_setOpen:function(c){var a,d,b;for(a in c)if(c.hasOwnProperty(a)){d=c[a];b=this.element.find(a);if(d)b.addClass("opened",300);else b.removeClass("opened",300)}},_setHashLayout:function(b){var a=h.bbq.getState()||{};a.layout=b;h.bbq.pushState(a,2)},_detailsSelected:function(){this._header(b,f,"Details");this._setOpen({"#details-pane":a,"#fillups-pane":c,"#reminders-pane":c})},_fillupsSelected:function(){this._header(b,f,"Fill ups");this._setOpen({"#details-pane":a,"#fillups-pane":a,"#reminders-pane":c})},_remindersSelected:function(){this._header(b,f,"Reminders");this._setOpen({"#details-pane":a,"#fillups-pane":a,"#reminders-pane":a})},moveOnScreenFromRight:function(){if(this.options.visible)return;this.element.removeClass("empty").css({left:900,opacity:0,position:i}).show().delay(m).animate({left:"-=640",opacity:1},l);this._setOption("visible",a)},moveOffScreenToRight:function(){var a=this,b=a;if(!a.options.visible)return;a.element.css({position:"absolute",top:0}).animate({left:"+=640",opacity:0},{duration:l,complete:function(){b.element.css({position:i});b.element.hide()}});a.options.visible=c},requeryVehicleDetails:function(){this._vehicleDetails(g)},requeryFillups:function(){this._fillups(g)},requeryReminders:function(){this._reminders(g)},destroy:function(){var a="destroy",b=this;b._vehicleDetails(a);b._fillups(a);b._reminders(a);h.Widget.prototype.destroy.call(b)}})})(this.mstats,jQuery);(function(a,b){b.widget("mstats.registration",{options:{sendRequest:function(a){b.ajax(a)},publish:function(){a.log("The publish option on registration has not been set")},displayNameChanged:null},_create:function(){this._bindNavigation()},_bindNavigation:function(){var a=this;this.element.delegate("form","submit.registration",function(b){a.saveProfile();b.preventDefault()})},saveProfile:function(){var a=this,c=a,b=a.element,d={UserId:b.find("#UserId").val(),AuthorizationId:b.find("#AuthorizationId").val(),DisplayName:b.find("#DisplayName").val(),Country:b.find("#Country").val(),PostalCode:b.find("#PostalCode").val()};a._showSavingMessage();a.options.sendRequest({url:a.options.dataUrl,data:d,cache:false,success:function(){c._startHidingWidget();c._showSavedMessage();c._trigger("displayNameChanged",null,{displayName:d.DisplayName})},error:function(){c._showSavingErrorMessage()}})},_publishStatus:function(b){this.options.publish(a.events.status,b)},_showSavingMessage:function(){this._publishStatus({type:"saving",message:"Saving registration information...",duration:5e3})},_showSavedMessage:function(){this._publishStatus({type:"saved",message:"Registration saved",duration:5e3})},_showSavingErrorMessage:function(){this._publishStatus({type:"saveError",message:"An error occurred while saving your registration. Please try again.",duration:5e3})},_startHidingWidget:function(){this.element.find("#registration-content").slideUp("slow").end().delay(2e3).slideUp("slow")}})})(this.mstats,jQuery);(function(e,a){var b="chart-url",c={};if(a.jqplot&&a.jqplot.config)a.jqplot.config.enablePlugins=true;function d(c,d){var b=false;a.jqplot(c,d,{axes:{xaxis:{renderer:a.jqplot.DateAxisRenderer,tickInterval:"3 months",pad:1.5,rendererOptions:{tickRenderer:a.jqplot.CanvasAxisTickRenderer},tickOptions:{formatString:"%m-%y",fontSize:"8pt",fontFamily:"Tahoma",angle:0,fontWeight:"normal",fontStretch:1}}},axesDefaults:{useSeriesColor:true},cursor:{show:b,showVerticalLine:b,showHorizontalLine:b,showCursorLegend:b,showTooltip:b,zoom:b,intersectionThreshold:6},legend:{location:"s",show:b},seriesDefaults:{showMarker:true},series:[{lineWidth:2,markerOptions:{style:"filledCircle",size:6}}]})}a.widget("mstats.vehicleCharts",{options:{sendRequest:function(b){a.ajax(b)}},chartData:[],_create:function(){this._fetchChartData()},_fetchChartData:function(){var a=this,c=this.element;c&&a.options.sendRequest({url:c.data(b),type:"POST",success:function(b){a._updateChartData(b);a._plotCharts()}})},_updateChartData:function(d){if(!d||!d.Entries||!d.Entries.length)return;for(var k=-1,b=-1,c=0,g=[],h=[],i=[],l=d.Entries.length,a,f,e,j=0;j<l;j+=1){a=d.Entries[j];if(k!==a.Id){b+=1;c=0;g[b]={id:a.Id,name:a.Name,series:[]};h[b]={id:a.Id,name:a.Name,series:[]};i[b]={id:a.Id,name:a.Name,series:[]}}f=a.Month.toString();if(a.Month<10)f="0"+f;e=a.Year.toString()+"-"+f+"-01";g[b].series[c]=[e,a.AverageFuelEfficiency];h[b].series[c]=[e,a.TotalDistance];i[b].series[c]=[e,a.TotalCost];c+=1;k=a.Id}this.chartData=[g,h,i]},_plotCharts:function(){var b=this,a=b.chartData;a&&a.length>0&&b._plotChart("#vehicle-fuel-efficiency-chart",a[0]);a&&a.length>1&&b._plotChart("#vehicle-distance-chart",a[1]);a&&a.length>2&&b._plotChart("#vehicle-cost-chart",a[2])},_plotChart:function(i,j){var g,e,f,h;if(!j||!j.length)return;g=this.element.find(i);g.empty();f=this.element.data(b)+i;if(c[f])c[f].appendTo(g);else{h=i.slice(1)+"-container";c[f]=a("<div></div>").attr("id",h).addClass("display-chart").appendTo(g);e=this._getJQPlotSeries(j);if(!e||!e.values.length)return;d(h,e.values)}},_getJQPlotSeries:function(d){for(var c=[],f=d.length,a,e=0,b=0;b<f;b+=1){a=d[b].series;if(a.length!==0){c[e]=a;e+=1}}return{values:c}}})})(this.mstats,jQuery);(function(l,c){var f="relative",j="absolute",i="#unavailable-message",h="#date-range-selection",e="#main-chart-plot",d="#loading-message",g="chart-url",a=false,b=true,k=800,m=450;if(c.jqplot&&c.jqplot.config)c.jqplot.config.enablePlugins=b;c.widget("mstats.charts",{options:{sendRequest:function(a){c.ajax(a)},currentChart:0,visible:a,invalidateData:function(){l.log("The invalidateData option on charts has not been set")}},chartData:[],getChartData:function(){return this.chartData},_create:function(){var a=this;a.wellKnownChartTitles=["Average Fuel Efficiency","Total Distance","Total Cost"];a.wellKnownSeriesColors=["#4bb2c5","#c5b47f","#EAA228","#579575","#839557","#958c12","#953579","#4b5de4","#d8b83f","#ff5800"];a.dateRange={min:0,lower:0,upper:0,max:0};a.datesInDateRange=[];a._bindNavigation();a._createDateRangeSlider();a._fetchChartData()},_createDateRangeSlider:function(){var a=this;this.element.find("#slider").slider({range:b,min:0,max:0,values:[0,0],slide:function(c,b){a.dateRange.lower=b.values[0];a.dateRange.upper=b.values[1];a._updateRangeDatesText();a._refreshChart()}})},_resetDateRangeSlider:function(){var a=this;a.element.find("#slider").slider({min:a.dateRange.min,max:a.dateRange.max-1,values:[a.dateRange.min,a.dateRange.max-1]});a._updateRangeDatesText()},_updateRangeDatesText:function(){var a=this;a.datesInDateRange.length>a.dateRange.lower&&a.element.find("#lower").html(a.datesInDateRange[a.dateRange.lower]);a.datesInDateRange.length>a.dateRange.upper&&a.element.find("#upper").html(a.datesInDateRange[a.dateRange.upper])},showMainFuelEfficiencyChart:function(){this._showChartById(0)},showMainDistanceChart:function(){this._showChartById(1)},showMainCostChart:function(){this._showChartById(2)},_showChartById:function(a){if(this.options.currentChart===a)return;this.options.currentChart=a;this._refreshChart()},_bindNavigation:function(){var a=this,c=a,b="click."+a.name;a.element.find("#fuel-efficiency-link").bind(b,function(a){c.showMainFuelEfficiencyChart();a.preventDefault()});a.element.find("#distance-link").bind(b,function(a){c.showMainDistanceChart();a.preventDefault()});a.element.find("#cost-link").bind(b,function(a){c.showMainCostChart();a.preventDefault()})},refreshData:function(){this._fetchChartData()},requeryData:function(){this.options.invalidateData(this.element.data(g));this.refreshData()},_fetchChartData:function(){var a=this,b=this.element;if(b){a.element.find(d).show();a.options.sendRequest({url:b.data(g),success:function(b){a._updateChartData(b);a._resetDateRangeSlider();a._refreshChart()}})}},_updateChartData:function(h){var f=this;if(!h||!h.Entries)return;for(var a,g,e,o=-1,c=-1,d=0,n=[],k=[],i=[],j=[],l=[],m=0;m<h.Entries.length;m+=1){a=h.Entries[m];if(o!==a.Id){c+=1;d=0;k[c]=[];n[c]={id:a.Id,name:a.Name};i[c]={id:a.Id,name:a.Name,series:[]};j[c]={id:a.Id,name:a.Name,series:[]};l[c]={id:a.Id,name:a.Name,series:[]}}g=a.Month.toString();if(a.Month<10)g="0"+g;e=a.Year.toString()+"-"+g+"-01";i[c].series[d]=[e,a.AverageFuelEfficiency];j[c].series[d]=[e,a.TotalDistance];l[c].series[d]=[e,a.TotalCost];k[c][d]=e;d+=1;o=a.Id}f._setupDateRange(k);f.selectableVehicles=n;f.selectableVehiclesDirty=b;f.chartData=[i,j,l]},_setupDateRange:function(c){var a=this;for(var i,g,h,e,f,d=[],j=c.length,b=0;b<j;b+=1){g=a._convertToUTCDate(c[b][0]);if(!e||g<e)e=g;i=c[b].length-1;h=a._convertToUTCDate(c[b][i]);if(!f||h>f)f=h}d=a._buildMonthListWithoutGaps(e,f);a.dateRange.max=d.length;a.dateRange.upper=d.length-1;a.datesInDateRange=d},_buildMonthListWithoutGaps:function(c,d){var a,e,b,g,f=[];if(!c||!d)return[];e={year:c.getUTCFullYear(),month:c.getUTCMonth()};b={year:d.getUTCFullYear(),month:d.getUTCMonth()};a=e;while(a.year<b.year||a.year===b.year&&a.month<=b.month){g=a.month<10?"0":"";f.push(a.year+"-"+g+a.month+"-01");if(a.month===12){a.year+=1;a.month=0}a.month+=1}return f},_refreshChart:function(){var a=this,c=a.chartData,b=a.options.currentChart;if(!a.options.visible)return;a._updateSelectableVehicleList();if(b>=0&&b<a.wellKnownChartTitles.length&&a.dateRange.max>0){a.element.find(e).show();if(c&&c.length>b)a._plotChart(e,a.wellKnownChartTitles[b],c[b]);else a._showNoChartDataAvailableError()}else a._showNoChartDataAvailableError()},_plotChart:function(j,i,f){var e=this;if(!f||!f.length){e._showNoChartDataAvailableError();return}var d=e._getJQPlotSeries(f),g="mstats-main-chart-container",h=e.element.find(j);h.children().remove();c("<div></div>").attr("id",g).appendTo(h);if(!d||!d.values.length)return;try{c.jqplot(g,d.values,{title:i,noDataIndicator:{show:b,indicator:"No Data to Display"},axes:{xaxis:{renderer:c.jqplot.DateAxisRenderer,tickInterval:"2 months",rendererOptions:{tickRenderer:c.jqplot.CanvasAxisTickRenderer},tickOptions:{angle:0,fontStretch:1,fontSize:"10pt",fontWeight:"normal",fontFamily:"Tahoma",formatString:"%m-%y"}}},axesDefaults:{useSeriesColor:b},cursor:{show:a,showVerticalLine:a,showHorizontalLine:a,showCursorLegend:a,showTooltip:a,zoom:a,intersectionThreshold:6},legend:{location:"s",show:b},seriesDefaults:{showMarker:b},series:d.labels.concat([{lineWidth:4,markerOptions:{style:"filledCircle"}}]),seriesColors:d.colors})}catch(k){l.log("An error occured in jqPlot while attempting to render the chart: "+k)}e._hideNoChartDataAvailableError()},_updateSelectableVehicleList:function(){var e="<div/>",b=this,i=b,f,h,g,d;if(!b.selectableVehiclesDirty)return;if(b.selectableVehicles){g=c(e);g.children().remove();for(d=0;d<b.selectableVehicles.length;d+=1){f=c(e);f.addClass("chart-selectable-vehicle");f.append(c(e).css("background-color",b.wellKnownSeriesColors[d].toString()).addClass("chart-selectable-vehicle-color"));h=c('<input type="checkbox"></input>').addClass("chart-selectable-vehicle-checkbox").attr("name",b.selectableVehicles[d].id.toString()).val(b.selectableVehicles[d].id.toString());f.append(h).append(b.selectableVehicles[d].name);f.appendTo(g)}b.element.find("#vehicle-selection-list").children().remove().end().append(g.html()).find("input").attr("checked","checked").bind("click."+b.name,function(){i._refreshChart()})}b.selectableVehiclesDirty=a},_showNoChartDataAvailableError:function(){var a=this;a.element.find(e).hide().children().remove();a.element.find(h).hide();a.element.find(i).show();a.element.find(d).hide()},_hideNoChartDataAvailableError:function(){this.element.find(d).hide();this.element.find(i).hide();this.element.find(h).show()},_getJQPlotSeries:function(g){for(var h=this.element.find("#vehicle-selection"),e=[],d=[],f=[],b=0,a,c=0;c<g.length;c+=1){a=g[c];if(a.series.length!==0&&h.find('input:checked[name="'+a.id+'"]').length>0){e[b]={label:a.name};d[b]=this.wellKnownSeriesColors[c];f[b]=this._filterSeriesByDateRange(a.series);b+=1}}return{labels:e,colors:d,values:f}},_filterSeriesByDateRange:function(b){var a=this,d=a.datesInDateRange[a.dateRange.lower],f=a.datesInDateRange[a.dateRange.upper],e=a;return c.grep(b,function(a){return e._isDateInRange(a[0],d,f)})},_isDateInRange:function(d,g,h){var c=this._convertToUTCDate(d),e=this._convertToUTCDate(g),f=this._convertToUTCDate(h);return c<e||c>f?a:b},_convertToUTCDate:function(d){var e=/(\d{4})-(\d{2})-(\d{2})/g,a,c,b;a=e.exec(d);c=a[1];b=a[2];return new Date(c,b,1)},moveOnScreenFromRight:function(){var a=this,c=a;if(a.options.visible)return;a.options.visible=b;a.element.removeClass("empty").css({left:500,opacity:0,position:j}).show().delay(m).animate({left:"-=500",opacity:1},{duration:k,complete:function(){c.element.css({position:f});c._refreshChart()}})},moveOffScreenToRight:function(){var b=this,c=b;if(b.options.visible){b.element.css({position:j,top:0}).animate({left:"+=500",opacity:0},{duration:k,complete:function(){c.element.css({position:f});c.element.hide()}});b.options.visible=a}}})})(this.mstats,jQuery);(function(e,b){var a="#pinnedSiteCallout",d;function f(){b(a).show()}function c(){b(a).hide()}e.pinnedSite={initializePinnedSiteImage:function(){if(!(!document.documentMode||this.isPinned())){b("#pinnedSiteImage").bind("mousedown mouseout",c).bind("mouseover",f).addClass("active");b(a).show();setTimeout(c,5e3)}},intializeData:function(a){d=a;this.requeryJumpList()},requeryJumpList:function(){var a=e.getRelativeEndpointUrl;try{this.isPinned()&&d({url:"/reminder/overduelist/",contentType:"application/json",cache:false,success:function(g){try{var b=window.external,j=a("/favicon.ico"),e,h,c=g.Reminders.length,i,f,d;b.msSiteModeClearJumpList();b.msSiteModeCreateJumpList("Reminders");b.msSiteModeClearIconOverlay();if(g.Reminders){for(d=0;d<c;d+=1){f=g.Reminders[d];i=a("/reminder/details/"+f.Reminder.ReminderId.toString());b.msSiteModeAddJumpListItem(f.FullTitle,i,j,"self")}if(c>0){e="/content/overlay-"+c+".ico";h="You have "+c.toString()+" maintenance tasks that are ready to be accomplished.";if(c>3)e="/content/overlay-3plus.ico";b.msSiteModeSetIconOverlay(a(e),h)}}b.msSiteModeShowJumpList()}catch(k){}}})}catch(b){}},isPinned:function(){try{return window.external.msIsSiteMode()}catch(a){return false}}}})(this.mstats=this.mstats||{},jQuery);(function(b,c){var a="#statistics-content";c.widget("mstats.statisticsPane",{options:{sendRequest:function(a){c.ajax(a)},invalidateData:function(){b.log("The invalidateData option on statisticsPane has not been set")},publish:function(){b.log("The publish option on summaryPane has not been set")}},_create:function(){this._getStatisticsData()},_applyTemplate:function(f){var e=this.options,d=c(e.templateId);if(!d.length){b.log("Cannot apply templates as there is no template defined.");return}this.element.find(a).html(d.tmpl(f))},_getStatisticsData:function(){var a=this;this.options.sendRequest({url:this.options.dataUrl,success:function(b){a._applyTemplate(b);a._showStatistics()},error:function(){a._hideStatistics();a._showErrorMessage()}})},_showStatistics:function(){this.element.find(a).show()},_hideStatistics:function(){this.element.find(a).hide()},_showErrorMessage:function(){this.options.publish(b.events.status,{type:"loadingError",message:"An error occurred while loading your overall statistics.  Please try again.",duration:1e4})},refreshData:function(){this._getStatisticsData()},requeryData:function(){this.options.invalidateData(this.options.dataUrl);this.refreshData()}})})(this.mstats,jQuery);(function(c,b){var a="#summary-reminders-content";b.widget("mstats.imminentRemindersPane",{options:{sendRequest:function(a){b.ajax(a)},invalidateData:function(){c.log("The invalidateData option on imminentReminders has not been set")},publish:function(){c.log("The publish option on imminentReminders has not been set")}},_create:function(){this._getImminentReminderData()},_applyTemplate:function(e){if(!b(this.options.templateId).length){c.log("Cannot apply templates as there is no template defined.");return}var d={ReminderList:e};this.element.find(a).html(b(this.options.templateId).tmpl(d,{createRemindersLink:function(e){var a=b.bbq.getState()||{},d=c.getBaseUrl();a.layout="reminders";a.vid=e;return b.param.fragment(d,a)}}))},_getImminentReminderData:function(){var b=this,a=b;b._hideReminders();b.options.sendRequest({url:b.options.dataUrl,success:function(b){a._applyTemplate(b);a._showReminders();a.option(a.options)},error:function(){a._hideReminders();a._showErrorMessage()}})},_showReminders:function(){this.element.find(a).show()},_hideReminders:function(){this.element.find(a).hide()},refreshData:function(){this._getImminentReminderData()},requeryData:function(){this.options.invalidateData(this.options.dataUrl);this.refreshData()},_publishStatus:function(a){this.options.publish(c.events.status,a)},_showErrorMessage:function(){this._publishStatus({type:"loadError",message:"An error occurred while loading the summary reminders data.  Please try again.",duration:1e4})}})})(this.mstats,jQuery);(function(c,d){var b="requeryData",a=null,e=600,f=400;d.widget("mstats.summaryPane",{options:{visible:true,sendRequest:function(a){d.ajax(a)},publish:function(){c.log("The publish option on summaryPane has not been set")},invalidateData:function(){c.log("The invalidateData option on summaryPane has not been set")},header:a},registration:a,imminentRemindersPane:a,statisticsPane:a,_create:function(){var a=this;a._setupRegistrationWidget();a._setupStatisticsWidget();a._setupRemindersWidget();c.setupWidgetInvocationMethods(a,a,["statisticsPane","registration","imminentRemindersPane"]);c.setupWidgetInvocationMethods(a,a.options,["header"])},_setupRegistrationWidget:function(){var a=this,c=a,b=a.element.find("#registration");a.registration=b.registration({dataUrl:b.data("url"),publish:a.options.publish,sendRequest:a.options.sendRequest,displayNameChanged:function(b,a){c._header("option","displayName",a.displayName)}})},_setupStatisticsWidget:function(){var a=this,b=a.element.find("#statistics");a.statisticsPane=b.statisticsPane({sendRequest:a.options.sendRequest,dataUrl:b.data("url"),invalidateData:a.options.invalidateData,templateId:"#fleet-statistics-template"})},_setupRemindersWidget:function(){var a=this,b=a.element.find("#reminders");a.imminentRemindersPane=b.imminentRemindersPane({sendRequest:a.options.sendRequest,dataUrl:b.data("url"),invalidateData:a.options.invalidateData,templateId:"#summary-imminent-reminders-template"})},moveOffScreen:function(){var a=this,b=a;if(!a.options.visible)return;a.element.delay(f).animate({left:"-=350",opacity:0},{duration:e,complete:function(){b.element.hide()}});a._setOption("visible",false)},moveOnScreen:function(){if(this.options.visible)return;this.element.css("opacity",0).animate({opacity:1,left:"+=350"},e).show();this._setOption("visible",true)},requeryStatistics:function(){this._statisticsPane(b)},requeryReminders:function(){this._imminentRemindersPane(b)},destroy:function(){var a="destroy",b=this;d.Widget.prototype.destroy.call(b);b._statisticsPane(a);b._registration(a);b._imminentRemindersPane(a)}})})(this.mstats,jQuery);(function(j,h){var g="moveOnScreen",i="moveOnScreenFromRight",c="moveOffScreenToRight",f="moveOffScreen",e="title",a="option",d=null,b="dashboard";h.widget("mstats.layoutManager",{options:{layout:b,subscribe:function(){j.log("The subscribe option on layoutManager has not been set")},pinnedSite:d,charts:d,header:d,infoPane:d,summaryPane:d,vehicleList:d},_create:function(){var a=this,b=h.bbq.getState()||{};j.setupWidgetInvocationMethods(a,a.options,["charts","header","infoPane","summaryPane","vehicleList"]);a._subscribeToGlobalEvents();a._subscribeToHashChange();b&&b.layout&&a._setOption("layout",b.layout);a._changeLayout(b)},_subscribeToGlobalEvents:function(){var d="requeryData",c="requeryReminders",e="requeryStatistics",f=this,g={},a=f;f.options.subscribe(j.events.vehicle.deleted,function(){a._summaryPane(e);a._summaryPane(c);a._vehicleList(d);a._charts(d);g.layout=b;h.bbq.pushState(g,2)},f);f.options.subscribe(j.events.vehicle.reminders.fulfilled,function(){a._summaryPane(e);a._summaryPane(c);a._infoPane("requeryVehicleDetails");a._infoPane(c);a._charts(d);a.options.pinnedSite.requeryJumpList()},f)},_changeLayout:function(d){var c=this;c._setOption("layout",d.layout||b);c._setupInfoPaneOptions(d);switch(c.options.layout){case b:c._header(a,e,"Dashboard");c._goToDashboardLayout();break;case"charts":c._goToChartsLayout();c._header(a,e,"Charts");break;case"details":c._setHeaderForSelectedVehicle("Details");c._goToDetailsLayout();break;case"fillups":c._setHeaderForSelectedVehicle("Fill ups");c._goToDetailsLayout();break;case"reminders":c._setHeaderForSelectedVehicle("Reminders");c._goToDetailsLayout()}},_setHeaderForSelectedVehicle:function(d){var c=this._infoPane("getSelectedVehicleName"),b=d;if(c)b=b+" for "+c;this._header(a,e,b)},_subscribeToHashChange:function(){var a=this;h(window).bind("hashchange.layoutManager",function(){var b=h.deparam.fragment(true);a._changeLayout(b)})},_setupInfoPaneOptions:function(c){var b="selectedVehicleId";this._vehicleList(a,b,c.vid);this._infoPane(a,b,c.vid);this._infoPane(a,"activePane",c.layout)},_goToChartsLayout:function(){var a=this;a._summaryPane(f);a._vehicleList(f);a._infoPane(c);a._charts(i)},_goToDetailsLayout:function(){var a=this;a._charts(c);a._summaryPane(f);a._infoPane(i);a._vehicleList(g);a._vehicleList("goToDetailsLayout")},_goToDashboardLayout:function(){var a=this;a._charts(c);a._summaryPane(g);a._vehicleList(g);a._infoPane(c);a._vehicleList("goToDashboardLayout")},destroy:function(){h.Widget.prototype.destroy.call(this)}})})(this.mstats=this.mstats||{},jQuery);(function(c,a){c.VehicleDropDownMonitor=function b(f,e){if(!(this instanceof b))return new b(f,e);var d={};d.initialize=function(){var c="Could not load vehicle data lists.",b=":first",f=a("#vehicleEditForm"),i=a("#Year",f),g=a("#MakeName",f),h=a("#ModelName",f),k=f.data("makes-url"),j=f.data("models-url");f.find('input[name="UpdateMakes"]').remove().end().find('input[name="UpdateModels"]').remove();i.change(function(){g.children().not(b).remove();h.children().not(b).remove();e({url:k,data:{year:i.val()},cache:false,success:function(a){d._updateList(a,g)},error:function(){d._publishError(c)}})});g.change(function(){h.children().not(b).remove();e({url:j,cache:false,data:{year:i.val(),make:g.val()},success:function(a){d._updateList(a,h)},error:function(){d._publishError(c)}})})};d._updateList=function(c,b){a.each(c,function(d,c){b.append(a("<option></option>").attr("value",c).text(c))})};d._publishError=function(a){f(c.events.status,{type:"loadError",message:a})};return d}})(this.mstats=this.mstats||{},jQuery);$(function(){var e,a,d,b,c;$(document).ajaxError(function(d,a){if(a.status===200)if(a.responseText.indexOf("Mileage Stats Sign In")!==-1)window.location.replace(mstats.getRelativeEndpointUrl("/Auth/SignIn"));else a.responseText.indexOf("Mileage Stats | Accident!")!==-1&&window.location.replace(mstats.getRelativeEndpointUrl("/GenericError.htm"))});$("#notification").status({subscribe:mstats.pubsub.subscribe});a=$("#header").header();mstats.pinnedSite.intializeData(mstats.dataManager.sendRequest);if(!window.location.pathname.match(/Dashboard/))return;c=$("#vehicles").vehicleList({publish:mstats.pubsub.publish,sendRequest:mstats.dataManager.sendRequest,invalidateData:mstats.dataManager.resetData,templateId:"#mstats-vehicle-list-template"});d=$("#info").infoPane({sendRequest:mstats.dataManager.sendRequest,invalidateData:mstats.dataManager.resetData,publish:mstats.pubsub.publish,header:a});b=$("#summary").summaryPane({sendRequest:mstats.dataManager.sendRequest,invalidateData:mstats.dataManager.resetData,publish:mstats.pubsub.publish,header:a});e=$("#main-chart").charts({sendRequest:mstats.dataManager.sendRequest,invalidateData:mstats.dataManager.resetData});$("body").layoutManager({subscribe:mstats.pubsub.subscribe,pinnedSite:mstats.pinnedSite,charts:e,header:a,infoPane:d,summaryPane:b,vehicleList:c})});